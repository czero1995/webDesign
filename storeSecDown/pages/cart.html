<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>购物车</title>
		<link rel="stylesheet" href="../css/framework7.ios.min.css">
		<link rel="stylesheet" href="../css/base.css">
		<link rel="stylesheet" href="../css/footer.css">
		<link rel="stylesheet" href="../css/cart.css" />
	</head>

	<body>

		<div class="views tabs" id="app">
			<div id="home-lesson" class="view view-main tab active">
				<div class="pages">
					<div  class="page">
						<div class="page-content" v-cloak>
							<div id="cart">
								<div class="noPage" v-show="ShopPage">
									<img src="../img/icon/404.png" class="noImg" />
									<p class="noText">购物车空空，去逛逛吧</p>
									<a href="../index.html" class="external">
										<p>去逛逛
										</p>
									</a>
								</div>
								<div v-show="!ShopPage" class="cartContent">
									<div class="cartItem inlinkFlex" v-for="(itemGoods,indexGoods) in cartList" >
										
											<div class="shopRadio"  @click="onShopRadio(itemGoods)">
												<img src="../img/icon/radio.png" v-show="!itemGoods.shopRadio"/>
												<img src="../img/icon/radio_select.png" v-show="itemGoods.shopRadio" />																							
											</div>
											<a href="detail.html" class="external">
												<div class="cartImage">
													<img :src="itemGoods.image"/>
												</div>
											</a>
											
											<div class="cartDetail inlinkFlex-spacebetween">
												<a href="detail.html" class="external">
												<div class="cartText">
													<div class="inlinkFlex-spacebetween">
														<p class="text-ellipsis">{{itemGoods.name}}</p>
												</a>
														<img src="../img/icon/shop_delect.png" @click="onCartDel(itemGoods)"/>
													</div>
													<a href="detail.html" class="external">
													<p class="itemIntro text-ellipsis">{{itemGoods.intro}}</p>
													<p class="shopCoach">¥ {{itemGoods.price * itemGoods.count}}</p>
												</a>
													<div class="cartOp inlinkFlex">
														<img src="../img/icon/shop_cut.png" @click.stop="onCutCart(itemGoods)" />
														<input type="text" :value="itemGoods.count" />
														<img src="../img/icon/shop_add.png" @click.stop="onAddCart(itemGoods)" />
													</div>
												</div>
												
											</div>
										
									</div>
									
								</div>
						
						</div>
						</div>
						<div class="toolbar tabbar tabbar-labels">
							<p class="freight">满38.00元免运费</p>
							<div class="toolbar-inner">								
									<div class="cartBottom-detail inlinkFlex">
										<div class="shopRadio" @click="onShopRadioAll()">
											<img src="../img/icon/radio.png" v-show="!shopRadioAll" />
											<img src="../img/icon/radio_select.png" v-show="shopRadioAll"/>
										</div>
										<div class="bottom-left">
											<p>合计: <span class="shopCoach">¥ {{allCoach}}</span> </p>
										</div>

										<div class="subminCart">
											<a href="order.html" class="external">提交订单</a>
										</div>								
							</div>
						</div>						
						</div>
					</div>
				</div>
			</div>

		</div>

		<script src="../js/rem.js"></script>
		<script type="text/javascript" src="../js/framework7.min.js"></script>
		<script type="text/javascript" src="../js/my-app.js"></script>
		<script type="text/javascript" src="../js/axios.js"></script>
		<script src="../js/vue.js"></script>
		<script>
			new Vue({
				el: '#app',
				data() {
					return {
						cartList:[],
						ShopPage: false,
						shopRadioAll:false,
						cartNum: '1',
						itemCoach: '40.00',
						allCoach: 0,
					    
					}
				},
				mounted:function(){
					this.getCart()
				},	
				methods: {
					getCart(){
						const that = this;
						 axios.get('../data/cartData.json').then(function (response) {
						 		that.cartList = response.data.list;
		                       console.log(that.cartList);
		                    })
		                    .catch(function (error) {
		                        console.log(error);
		                    });
					},
					onShopRadio(gooditem){
						const that = this;
						if(typeof gooditem.shopRadio == 'undefined'){
							that.$set(gooditem,"shopRadio",true);
						}else{
							gooditem.shopRadio = !gooditem.shopRadio;
						}
						if(gooditem.shopRadio == false){
							that.shopRadioAll = false;
						}
						that.onCalAllCoach();
					},	
					onAddCart(gooditem) {
						const that = this;
						gooditem.count++;
						that.onCalAllCoach();	

					},
					onCutCart(gooditem) {
						const that = this;
						if(gooditem.count > 1) {
							gooditem.count--;
							that.onCalAllCoach();	
						}
					},					
					onShopRadioAll(){
						const that = this
						that.shopRadioAll = ! that.shopRadioAll;
						console.log(that.shopRadioAll)
						if(that.shopRadioAll == true){
							that.cartList.forEach(function(itemGoods){
								itemGoods.shopRadio = true;
								
							})
						}else{
							that.cartList.forEach(function(itemGoods){
								itemGoods.shopRadio = false;
							})
						}
						that.onCalAllCoach();	
					},
					onCalAllCoach(){
						const that = this;
						that.allCoach = 0;
						that.cartList.forEach(function(item,index){
							if(item.shopRadio){
								that.allCoach += item.count * item.price
							}
						})
					},
					onCartDel(item){
						const that = this;
						 myApp.confirm('确定删除商品？', '', 
						     function () {
						        var index = that.cartList.indexOf(item);
						        that.cartList.splice(index,1)
						      },						      
						    );
					}
				},				
			})
		</script>
	</body>

</html>