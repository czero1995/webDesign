{extend name="common/base"}
{block name="content-header"}
<link rel="stylesheet" href="__STATIC__/admin/plugins/select2/select2.min.css">
    <h1>
        {$module_names[0]}
        <small>
        {$module_names[1]}</small>
    </h1>
    <ol class="breadcrumb">
        {volist name="module_names" id="vo"}
            <li {if condition="$module_nums==$key"}class="active"{/if}>{if condition="0==$key"}<i class="fa fa-dashboard"></i>{/if} {$vo}</li>
        {/volist}
    </ol>
{/block}

{block name="content"}

        <div class="row">
            <div class="col-xs-12">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h3 class="box-title">角色列表</h3>
                    </div>
                    <div class="box-body">

                        <div id="toolbar">
                             <button type="button" style="margin-bottom: 1rem;" class="btn btn-primary" data-toggle="modal" data-target="#addRole" data-backdrop="static">
                                <span class="fa fa-plus" aria-hidden="true"></span> 新增角色
                            </button>
                           
                        </div>
                        <div id="app">
                            <table id="list-table" class="table table-bordered table-striped dataTable">
                         <thead>
                           <tr role="row">
                               <th>ID</th>
                               <th>角色名称</th>
                               <th>描述</th>
                               <th>添加人</th>
                               <th>添加时间</th>
                               <th>操作</th>
                           </tr>
                         </thead>
                        <tbody>
                            {volist name="list" id="vo"}
                            <tr role="row">
                                <td>{$vo.id}</td>
                                <td>{$vo.role}</td>
                                <td>{$vo.description}</td>
                                <td>{$vo.create_user}</td>
                                <td>{$vo.create_time}</td>
                                <td>
                                    <a class="btn btn-primary" href="{:url('admin/role/edit',array('id'=>$vo['id']))}" title="编辑"><i class="fa fa-pencil"></i></a>
                                    <if condition="$vo['id'] gt 1">
                                    <a class="btn btn-danger js_del" href="javascript:void(0)" data-url="{:url('admin/role/del')}" data-id="{$vo.id}" title="删除"><i class="fa fa-trash-o"></i></a>
                                   <!--  <a class="btn btn-danger js_del" title="删除" href="javascript:void(0)" v-on:click="delBanner(item.id,index)" data-id="7"><i class="fa fa-trash-o"></i></a> -->
                                    <a class="btn btn-danger" href="{:url('admin/role/setAuth',array('role_id'=>$vo['id']))}" data-id="{$vo.id}" title="分配权限"><i class="fa fa-unlock"></i></a>
                                    </if>
                                </td>
                            </tr>
                            {/volist}
                           </tbody>
                         <tfoot>
                         </tfoot>
                       </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>
    <div class="modal fade" id="addRole" style="color: #333;line-height:20px;font-size: 14px;" tabindex="-1" aria-hidden="true"
        data-backdrop="static">
        <div class="modal-dialog" style="width: 50%;margin-top: 100px !important;">
            <div class="modal-content">
                <div class="modal-header bordered-blue">
                    <button class="close" data-dismiss="modal"><span>&times;</span></button>
                    <h4 class="modal-title"><i class="fa fa-user"></i>添加角色</h4>
                </div>
                <div class="modal-body" style="margin-top: 10px !important;">
                    <form class="form-horizontal" method="post" id="form1">
                         <div class="form-group">
                            <label for="truename" class="col-sm-3 control-label" style="margin-right: -20px;">角色名：</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control required" v-model="form.role" id="role" name="role" placeholder="角色名">
                            </div>
                        </div>
                
                        <div class="form-group">
                            <label for="truename" class="col-sm-3 control-label" style="margin-right: -20px;">描述:</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control required" id="description" name="description" placeholder="描述" v-model="form.description">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary pull-right" @click="add_role">提交</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑用户-->
    <div class="modal fade" id="editRole" style="color: #333;line-height:20px;font-size: 14px;" tabindex="-1" aria-hidden="true"
        data-backdrop="static">
        <div class="modal-dialog" style="width: 50%;margin-top: 100px !important;">
            <div class="modal-content">
                <div class="modal-header bordered-blue">
                    <button class="close" data-dismiss="modal"><span>&times;</span></button>
                    <h4 class="modal-title"><i class="fa fa-user"></i>编辑角色</h4>
                </div>
                <div class="modal-body" style="margin-top: 10px !important;">
                    <form class="form-horizontal" method="post" id="form1">
                        <div class="form-group">
                            <label for="truename" class="col-sm-3 control-label" style="margin-right: -20px;">角色名：</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control required" v-model="form.role" id="role" name="role" placeholder="角色名">
                            </div>
                        </div>
                
                        <div class="form-group">
                            <label for="truename" class="col-sm-3 control-label" style="margin-right: -20px;">描述:</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control required" id="description" name="description" placeholder="描述" v-model="form.description">
                            </div>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary pull-right" @click="edit_role">提交</button>
                </div>
            </div>
        </div>
    </div>

</div>
{/block} 
{block name="script"}
<script src="/admin/js/vue.js"></script>
<script src="__STATIC__/admin/dist/js/axios.min.js"></script>
<script src="__STATIC__/admin/dist/js/es6-promise.auto.min.js"></script>

<script type="text/javascript">
$(".js_del").on("click",function(){

    var id = $(this).attr("data-id"),
        url = $(this).attr("data-url");
    layer.confirm('确认删除？', function(){
        $.ajax({
            type : 'post',
            url : url,
            data : {id:id},
            dataType : 'json',
            success : function(res){
                if( res.status == true ){
                    location.href = res.url;
                }else {
                    layer.alert(res.msg, {icon: 2});
                }
            }
        })
    });
});

    //添加分类
      var addCate = new Vue({
        el: '#addRole',
        data: {
            form: {}
        },
        methods: {
            add_role: function () {
                self = this;
                axios.post(api_url+"Role/addRole/",{           
                    role:self.form.role,
                    description:self.form.description
                })
                .then(function (response) {
                    if(response.data.errcode == 200){
                        //console.log(response);
                        layer.msg('添加成功',{icon:6,title:'温馨提示'},function(){
                            window.location =admin_url+"role/index";
                        });
                    }else{
                        layer.msg('添加失败',{icon:5,title:'温馨提示'});
                    }
                })
                .catch(function (error) {
                    console.log(error);
                })   
            },

        }
    });

      //编辑分类
/*      var editRole = new Vue({
        el: '#editRole',
        data: {
            form: {
                role: '',
                description: ''
            }
        },
        methods: {
            getData: function (element) {
                this.id = $(element).data('id');
                var self = this;
                $.getJSON(admin_url+'Role/editRole/id/' + this.id, function (res) {
                    console.log(res.data);
                    self.form = res.data;
                    $('#editRole').modal('show');
                })
            },
            edit_role: function () {
               
                var self = this;
                axios.post(api_url+'Role/editRole/id/'+this.id, {
                    role: self.form.role,
                    description: self.form.description 
                })
                .then(function (response) {
                    console.log(response.data);
                    if(response.data.errcode == 200)
                    {
                        layer.msg('修改成功',{icon:6,title:'温馨提示'},function () {
                            window.location =admin_url+"role/index";
                        })
                    } else {
                        layer.msg('修改失败',{icon:5,title:'温馨提示'},function () {
                            window.location.reload();
                        });
                    }
                })
                .catch(function (error) {
                    layer.msg('系统出错，请稍候再试！',{icon:5,title:'温馨提示'},function () {
                        window.location.reload();
                    });
                });

            },
        },
    });*/

</script>
{/block}