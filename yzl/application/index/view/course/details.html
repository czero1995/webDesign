{extend name="layout/base"}

{block name="title"}
<title>云之力</title>
{/block}

{block name="style"}
<link rel="stylesheet" href="__STATIC__/wx/css/lesson-detail.css?v=1.0.2">
<style type="text/css">

</style>
{/block}

{block name="content"}
<!-- Page, data-page contains page name-->
<div class="page">
    <!-- Scrollable page content-->
    <div class="page-content">
        <!--轮播-->
        <div class="swiper-container swiper-stadium">
            <div class="swiper-wrapper">
                <div class="swiper-slide" v-for="banner in banners">
                    <img :src="banner.post"/></div>
            </div>
            <div class="swiper-pagination"></div>
        </div>
        <div class="lessonDetail-box">
            <div class="lessonDetail-item">
                <p class="title-name">{{details.title}}</p>
                <p class="lessionDetail-title">{{details.sub_title}}</p>
                <div class="lessionDetail-label"><span class="label-item">{{details.tags}}</span></div>
            </div>
            <div class="lessonDetail-coach clearfloat" v-if="lessonCoach">
                <p class="title-name">金牌教练</p>
                <div class="coachContent">
	                <div class="coach-box" v-for="coach in details.coach_info">
	                    <a :href="coach.url" class="external">
	                        <div class="coach-item">
	                            <img :src="coach.headimg"/>
	                            <p>{{coach.name}}</p>
	                        </div>
	                    </a>
	
	                </div>
	            </div>
            </div>
            <div class="lessonDetail-contact" v-if="lessonAddress">
                <a :href="url" class="external">
                    <p class="title-name">{{info.title}}</p>
                    <div class="lessonDetail-address clearfloat">
                        <a :href="map" class="external">
                            <img src="__STATIC__/wx/img/ic_position_nor@2x.png" class="address-img"/>
                            <p>{{info.address}}</p></a>
                        <a :href="phone" class="external">
                            <span>
                                <img src="__STATIC__/wx/img/btn_phone_nor@2x.png" class="phone-img"/>
                            </span>
                        </a>
                    </div>
                </a>
            </div>
            <div class="lessonDetail-introduce">

                <p class="introduce-all" v-html="details.intro"></p>
            </div>
        </div>
    </div>
</div>

{/block}

{block name="script"}
<script type="text/javascript">
    var id = "{$id}";
    console.log(id);
    new Vue({
        el: '#app',
        data() {
            return {
                showBeVip: false,
                showPhone: false,
                showSex: false,
                showInfo: false,
                showSelected: false,
                isLabel: false,
                lessonCoach: true,
                lessonAddress: true,
                banners: [],
                details: {},
                info: {},
                phone: '',
                map: '',
                url: ''
            }
        },
        mounted: function () {
            setTimeout("var myApp = new Framework7();var mySwiper = myApp.swiper('.swiper-stadium', {pagination: '.swiper-stadium .swiper-pagination',speed: 400,spaceBetween: 100});", 500)
            this.getBanner();
            this.getCourseDetail();
        },
        methods: {
            getCourseDetail: function () {
                const that = this;
                axios.post(path + 'course/get_course_info/course_id/' + id)
                    .then(function (response) {
                        that.details = response.data.data;
                        if (that.details.stadium_info == null) {
                            that.lessonAddress = false;
                        } else {
                            that.info = response.data.data.stadium_info;
                            that.url = "{:url('stadium/details')}" + "?id=" + that.details.stadium_info.id;
                            that.phone = 'tel:' + that.details.stadium_info.tel;
                            that.map = 'http://apis.map.qq.com/tools/poimarker?type=1&keyword=南山区&center=' + that.details.stadium_info.latitude + ',' + that.details.stadium_info.longitude + '&radius=1000&key=4JOBZ-RCJRD-22T4R-PZ3XT-S3MW7-BPFV5&referer=yunzhili';
                        }
                        if (that.details.coach_info == null) {
                            that.lessonCoach = false;
                        } else {
                            that.details.coach_info.forEach(function (item) {
                                item.url = "{:url('coach/details')}" + "?id=" + item.id;
                            });
                        }

                        console.log('details', that.details);
                        console.log('info', that.info);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            getBanner: function () {
                const that = this;
                axios.post(path + 'index/get_banner_list/type/3')
                    .then(function (response) {
                        that.banners = response.data.data;
                        console.log("banner", that.banners);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
        }

    })
</script>
{/block}