{extend name="common/base"}
{block name="content-header"}
<link rel="stylesheet" href="__STATIC__/admin/plugins/select2/select2.min.css">
<link rel="stylesheet" href="/admin/layui/css/layui.css">
    <h1>
        {$module_names[0]}
        <small>
        {$module_names[1]}</small>
    </h1>
    <ol class="breadcrumb">
        {volist name="module_names" id="vo"}
            <li {if condition="$module_nums==$key"} class="active" {/if}>{if condition="0==$key"}<i class="fa fa-dashboard"></i>{/if} {$vo}</li>
        {/volist}
    </ol>
{/block}

{block name="content"}

        <div class="row">
            <div class="col-xs-12">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h3 class="box-title">会员列表</h3>
                    </div>
                    <div class="box-body">
                        <table class="table table-bordered"  id="app">
                            <tbody>
                                <tr>
                                    <th style="width: 20px">头像</th>
                                    <th style="width: 20px">昵称</th>
                                    <th style="width: 40px">姓名</th>
                                    <th style="width: 40px">身份</th>
                                    <th style="width: 40px">会员号</th>
                                    <th style="width: 40px">联系方式</th>
                                    <th style="width: 40px">性别</th>
                                    <th style="width: 40px">创建时间</th>
                                    
                                    <th style="width: 60px">操作</th>
                                </tr>
                                <tr v-for="(item,index) in itemList">
                                <td><img class="img-polaroid" style="height:50px;margin-right:10px;" :src="item.headimg"></td>
                                    <td>{{item.nickname}}</td>
                                    <td>
                                        <span class="" v-if="item.realname">{{item.realname}}</span>
                                        <span class="" v-else>--</span>
                                    </td>
                                    <td>
                                        <span class="btn btn-xs btn-success" v-if="item.member_num > 0"><i class="fa fa-user"></i> 会员</span>
                                        <span class="btn btn-xs btn-default" v-else><i class="fa fa-user"></i> 游客</span>
                                    </td>
                                    <td>
                                        <span v-if="item.member_num > 0"><i class="fa fa-id-card"></i> {{item.member_num}}</span>
                                        <span v-else>--</span>
                                    </td>
                                    <td>
                                        <span v-if="item.mobile > 0"><i class="fa fa-phone"></i> {{item.mobile}}</span>
                                        <span v-else>--</span>
                                    </td>
                                    
                                    <td>
                                        <span v-if="item.sex == 0">保密</span>
                                        <span v-else-if="item.sex == 1">男</span>
                                        <span v-else="item.sex == 2">女</span>
                                    </td>
                                    <td>{{item.create_time}}</td> 
                                    <td>  
                                        <a class="btn btn-primary" :href="item.url"  title="查看详情"><i class="fa fa-asterisk"></i></a>
                                        <a class="btn btn-danger js_del" title="删除" href="javascript:void(0)" v-on:click="del(item.id,index)" data-id="7"><i class="fa fa-trash-o"></i></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="box-footer clearfix pull-right" id="pages">

                        </div>

                    </div>
                </div>
            </div>
        </div>

    </section>

</div>
{/block}
{block name="script"}
<script src="/admin/js/vue.js"></script>
<script src="__STATIC__/admin/dist/js/axios.min.js"></script>
<script src="/admin/layui/layui.all.js"></script>
<script type="text/javascript">
    var app = new Vue({
        el:'#app',
        data: {
            page: 1,
            pageSize: 10,
            itemList: {}
        },
        created: function(){
            this.getData();
        },
        methods: {
            getData:function(){
                var self = this;
                $.getJSON(api_url+"member/getMemberList?page="+self.page+'&pageSize='+self.pageSize,function(res){
                    console.log(res);

                    res.data.forEach(function (val) {
                        val['url'] = "{:url('admin/member/detail')}"+'?id='+val['id'];
                    });

                    self.itemList = res.data;

                    layui.use('laypage', function()
                    {
                        var laypage = layui.laypage;

                        //执行一个laypage实例
                        laypage.render({

                            elem: 'pages', //注意，这里的ID，不用加 # 号
                            layout: ['count', 'prev', 'page', 'next', 'limit', 'skip'],
                            curr: self.page, //设置页码选中
                            count: res.count, //数据总数，从服务端得到
                            limit: self.pageSize, //设置条数选中
                            theme: '#1E9FFF',
                            prev: '<<',
                            next: '>>',
                            jump: function(obj, first)
                            {
                                //jump 分页触发函数
                                //obj包含了当前分页的所有参数，比如：
                                //console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                                //console.log(obj.limit); //得到每页显示的条数

                                self.page = obj.curr;
                                self.pageSize = obj.limit;

                                //首次不执行
                                if(!first){
                                    self.getData();
                                }
                            }

                        });
                    });

                })
            },
           
             //删除操作
             del:function(id,index){
            console.log(id);
                 if (confirm('确定要删除吗？')) {
                    $.getJSON(api_url+"member/delmember/id/"+id,function(res){
                        app.itemList.splice(index,1);
                    }); 
                    
                }
             }
        }
    });


</script>
{/block}