{extend name="common/base"}
{block name="content-header"}
<link rel="stylesheet" href="__STATIC__/admin/plugins/select2/select2.min.css">
<link rel="stylesheet" href="/admin/layui/css/layui.css">
    <h1>
        {$module_names[0]}
        <small>
        {$module_names[1]}</small>
    </h1>
    <ol class="breadcrumb">
        {volist name="module_names" id="vo"}
            <li {if condition="$module_nums==$key"}class="active"{/if}>{if condition="0==$key"}<i class="fa fa-dashboard"></i>{/if} {$vo}</li>
        {/volist}
    </ol>
{/block}

{block name="content"}

        <div class="row">
            <div class="col-xs-12">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h3 class="box-title">轮播图列表</h3>
                    </div>
                    <div class="box-body">

                        <div id="toolbar">
                            <div class="form-group pull-left" style="margin-right: 0.5rem;">
                                <a href="{:url('/admin/banner/add')}" class="btn btn-primary pull-right"><i class="fa fa-plus"></i>新增轮播图</a>
                            </div>
                        </div>
                        <div id="app">
                            <table class="table table-bordered">
                                <tbody>
                                    <tr>
                                        <th style="width: 20px">排序</th>
                                        <th style="width: 40px">轮播图类型</th>
                                        <th style="width: 40px">配图</th>
                                        <th style="width: 40px">轮播图说明</th>
                                        <th style="width: 40px">跳转链接</th>

                                        <th style="width: 40px">创建时间</th>
                                        <th style="width: 40px">状态</th>
                                        <th style="width: 60px">操作</th>
                                    </tr>
                                    <tr v-for="(item,index) in bannerlist">
                                        <td>{{item.sort}}</td>
                                        <td>
                                            <span v-if="item.type == 1">场馆</span>
                                            <span v-if="item.type == 2">教练</span>
                                            <span v-if="item.type == 3">课程</span>
                                        </td>

                                        <td><img class="img-polaroid" style="height:50px;text-align: center;" :src="item.post"></td>
                                        <td>{{item.title}}</td>
                                        <td>{{item.url}}</td>
                                        <td>{{item.create_time}}</td>
                                        <td>
                                            <span v-if="item.status == 1">启用</span>
                                            <span v-if="item.status == 2">禁用</span>
                                        </td>
                                        <td>
                                            <a class="btn btn-primary" title="编辑" :data-id="item.id" :href="'edit/id/'+item.id"><i class="fa fa-pencil"></i></a>
                                            <a class="btn btn-danger js_del" title="删除" href="javascript:void(0)" v-on:click="delBanner(item.id,index)" data-id="7"><i class="fa fa-trash-o"></i></a>
                                        </td>
                                    </tr>

                                </tbody>
                            </table>
                            <div class="box-footer clearfix pull-right" id="pages">

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>

</div>
{/block} {block name="script"}
<script src="/admin/js/vue.js"></script>
<script src="/admin/layui/layui.all.js"></script>
<script type="text/javascript">
    var app = new Vue({
        el: '#app',
        data: {
            page: 1,
            pageSize: 10,
            bannerlist: {},
//            pagelist: [],
//            startPage: 1,
//            nowPage: 1,
//            perPage:6 //每页数量
        },
        created: function () {
            this.getData(1);
        },

        methods: {
            getData: function (page) {
                this.nowPage = page;
                var self = this;
                $.getJSON(api_url + "banner/getBannerList?page="+self.page+'&pageSize='+self.pageSize, function (res) {
                    //console.log('res', res);
                    self.bannerlist = res.data.data;
                    //self.pagelist = res.page
                    layui.use('laypage', function()
                    {
                        var laypage = layui.laypage;

                        //执行一个laypage实例
                        laypage.render({

                            elem: 'pages', //注意，这里的ID，不用加 # 号
                            layout: ['count', 'prev', 'page', 'next', 'limit', 'skip'],
                            curr: self.page, //设置页码选中
                            count: res.data.count, //数据总数，从服务端得到
                            limit: self.pageSize, //设置条数选中
                            theme: '#1E9FFF',
                            prev: '<<',
                            next: '>>',
                            jump: function(obj, first)
                            {
                                //jump 分页触发函数
                                //obj包含了当前分页的所有参数，比如：
                                //console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                                //console.log(obj.limit); //得到每页显示的条数

                                self.page = obj.curr;
                                self.pageSize = obj.limit;

                                //首次不执行
                                if(!first){
                                    self.getData();
                                }
                            }

                        });
                    });
                })
            },
            //删除操作
            delBanner: function (id, index) {

                if (confirm('确定要删除吗？')) {
                    $.getJSON(api_url + "banner/deleteBanner/id/" + id, function (res) {
                        app.bannerlist.splice(index, 1);
                    });

                }
            },

        }
    });
</script>
{/block}