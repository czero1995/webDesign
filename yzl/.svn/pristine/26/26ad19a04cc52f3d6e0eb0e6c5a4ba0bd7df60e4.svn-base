{extend name="layout/base"}

{block name="title"}
<title>场馆详情</title>
{/block}

{block name="style"}
<link rel="stylesheet" href="__STATIC__/wx/css/stadium-detail.css">
<style type="text/css">
    .view, .pages {
        overflow: auto;
        background: #ebebeb;
    }

    ul {
        padding: 0;
    }

    .stadiumDetail-filter {
        height: 100%;
    }

    .introduce-p p {
        height: 100%;
    }
    .lesson-recommend{
        padding-bottom: 0 !important;
    }
    .statium-img{
    	width: 100%;
    	height: 3.2rem;
    }
    .statium-img img{
    	width: 100%;
    	height: 100%;
    }
</style>
{/block}

{block name="content"}
<div class="page">
    <div class="page-content">
       	<div class="statium-img">
       		<img :src="details.post" alt="" />
       	</div>
        <div class="stadium-item">
            <p class="title-name">{{details.title}}</p>
            <div class="stadium-address clearfloat">
                <img src="__STATIC__/wx/img/ic_position_nor@2x.png"/>
                <a v-bind:href="map" class="external"><span>{{details.address}}</span></a>
                <a v-bind:href="tel" class="external">
                    <span class="stadium-phone">
                    <img src="__STATIC__/wx/img/btn_phone_nor@2x.png"
                         class="phone-img"/>
                        </span>
                </a>
            </div>
        </div>
        <div class="stadium-content">
            <div class="stadium-introduce">
                <div v-html="details.intro" class="introduce-p"></div>
            </div>
            <div class="stadiumDetail-tabBox">
                <div class="tabBox-bar">
                    <p @click="onSelect('coachGold')" v-bind:class="{ active: selected === 'coachGold'}">金牌教练</p>
                    <p @click="onSelect('lessonService')" v-bind:class="{ active: selected === 'lessonService'}">
                        课程&服务</p>
                </div>
                <div class="stadiumDetail-filter">
                    <!--课程和服务-->
                    <div class="tabBox-lessonService" v-show="selected === 'lessonService'">
                        <ul class="lesson-recommend">
                            <li class="lessonService-item " v-for="course in details.course_info">
                                <a :href="course.url" class="external">
                                    <div class="lesson-box clearfloat">
                                        <div class="lesson-text">
                                            <div class="lesson-name">{{course.title}}</div>
                                            <div class="lesson-title">{{course.sub_title}}</div>
                                            <!--<div class="lesson-content">{{course.intro}}</div>-->
                                            <div class="lesson-price">¥{{course.price}}</div>
                                        </div>
                                        <img :src="course.post" class="lesson-img"/>
                                    </div>
                                    <div class="lesson-label">
                                        <div class="label-item">{{course.tags}}</div>
                                    </div>
                                </a>
                            </li>
                            <div class="coachMore" @click="onShowLessonPlay" v-show="coursemore">
                                <img src="__STATIC__/wx/img/btn_To recover_nor@2x.png" v-show="showBoxCourse"/>
                                <img src="__STATIC__/wx/img/btn_more_nor@2x.png" v-show="!showBoxCourse"/>

                            </div>
                        </ul>

                    </div>

                    <!--金牌教练-->
                    <div class="tabBox-stadium" v-show="selected === 'coachGold'">
                        <ul class="coach-recommend">
                            <li class="coach-item clearfloat" v-for="coach in details.coach_info">
                                <a :href="coach.url" class="external">
                                    <img :src="coach.headimg" class="coach-img"/>
                                    <div class="coach-info clearfloat">
                                        <span class="title-name">{{coach.title}}</span>
                                        <img src="__STATIC__/wx/img/ic_gender_man@2x.png" class="coach-sex-img"
                                             v-show="genderMan"/>
                                        <img src="__STATIC__/wx/img/ic_gender_women@2x.png" class="coach-sex-img"
                                             v-show="genderWomen"/>
                                        <p class="coach-introduce">
                                            {{coach.intro}}
                                        </p>
                                        <div class="coach-label" v-for="tagItem in coach.tags_name">
                                            <div class="label-item">{{tagItem.name}}</div>
                                        </div>
                                    </div>
                                </a>
                            </li>

                            <div class="coachMore" @click="onShowCoachPlay" v-show="coachmore">
                                <img src="__STATIC__/wx/img/btn_To recover_nor@2x.png" v-show="!showBox"/>
                                <img src="__STATIC__/wx/img/btn_more_nor@2x.png" v-show="showBox"/>

                            </div>
                        </ul>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="preBtn">
        <a :href="details.booking_url" class="external">预定
        </a>

    </div>
</div>
{/block}

{block name="script"}
<script type="text/javascript">

    var stateCoach = false;
    var stateLesson = false;
    var id = {$id};
    console.log(id);
    new Vue({
        el: '#app',
        data() {
            return {
                selected: 'coachGold',
                showBox: false,
                showBoxCourse:false,
                genderMan: false,
                genderWomen: false,
                coursemore:false,
                coachmore: false,
                banners: [],
                details: {},
                tel: '',
                map: ''
            }
        },
        mounted: function () {
            const that = this;
            that.$nextTick(function () {
                
                that.getStadiumDetail();

            });


        },
        methods: {
            getStadiumDetail: function () {
                const that = this;
                axios.post(path + 'stadium/get_stadium_info/stadium_id/' + id)
                    .then(function (response) {
                        that.details = response.data.data;
                        that.tel = 'tel:' + that.details.tel;
                        that.map = 'http://apis.map.qq.com/tools/poimarker?type=1&keyword=南山区&center=' + that.details.latitude + ',' + that.details.longitude + '&radius=1000&key=4JOBZ-RCJRD-22T4R-PZ3XT-S3MW7-BPFV5&referer=yunzhili';
                        if(that.details.course_info !=null){
                            that.details.course_info.forEach(function (item) {
                                item.url = "{:url('course/details')}" + "?id=" + item.id;
                                console.log('id', item.id);
                            });
                            if(that.details.course_info.length>3){
                                that.coursemore=true;
                            }
                            console.log(1364, that.details.course_info.length)
                        }

                        if (that.details.coach_info != null) {
                            that.details.coach_info.forEach(function (item) {
                                item.url = "{:url('coach/details')}" + "?id=" + item.id;
                                console.log('id', item.id);

                            });
                            if (that.details.coach_info.length > 3) {
                                that.coachmore = true;
                            }
                            console.log(1341, that.details.coach_info.length)
                        }


                        //that.onShowCoach();
                        console.log('that.details', that.details);

                        setTimeout(function () {
                            that.onShowCoach();
                            that.onShowLesson();
                        }, 200)

                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            getBanner: function () {
                const that = this;
                axios.post(path + 'index/get_banner_list/type/1')
                    .then(function (response) {
                        that.banners = response.data.data;
                        console.log('banner', that.banners);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            onSelect: function (selected) {
                this.selected = selected;

            },
            onShowCoach: function () {
                this.showBox = !this.showBox;
                if (stateCoach == false) {
                    $('.coach-recommend li').hide();
                    $(".coach-recommend li").eq(0).show();
                    $(".coach-recommend li").eq(1).show();
                    $(".coach-recommend li").eq(2).show();
                    stateCoach = true;
                } else {

                    stateCoach = false;
                }

            },
            onShowCoachPlay:function(){
                $('.coach-recommend li').show();
                this.coachmore = false;
            },
            onShowLessonPlay:function(){
                $('.lesson-recommend li').show();
                this.coursemore=false;
            },
            onShowLesson:function(){
                this.showBoxCourse = false;
                if (stateLesson == false) {
                    $(".lesson-recommend li").hide();
                    $(".lesson-recommend li").eq(0).show();
                    $(".lesson-recommend li").eq(1).show();
                    $(".lesson-recommend li").eq(2).show();
                    stateLesson= true;
                } else {
                    $('.lesson-recommend li').show();
                    stateLesson = false;
                }
            }
        }

    })
</script>
{/block}