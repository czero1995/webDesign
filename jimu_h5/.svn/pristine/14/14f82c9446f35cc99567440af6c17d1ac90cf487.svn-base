<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
		<title>购物车</title>
		<script src="../js/rem.js"></script>
		<link rel="stylesheet" href="../css/base.css">
		<link rel="stylesheet" href="../css/cart.css" />
	</head>

	<body>
		<div id="app">
			<div class="top">
				<p>购物车</p>
			</div>
			<div class="container">
				<div class="cart-item inlinkFlex" v-for="cartItem in cartList">
					<div class="goods-radio" @click="onGoodsRadio(cartItem)">
						<img src="../img/icon/radio.png" v-show="!cartItem.goodsRadio" />
						<img src="../img/icon/radio_select.png" v-show="cartItem.goodsRadio" />
					</div>
					<a :href="'detail.html?id='+cartItem.goods_id" class="inlinkFlex">
						<div class="goods-img">
							<img :src="cartItem.goods_thumb" />
						</div>
						<div class="goods-textBox">
							<p class="text-ellipsis goods-name">{{cartItem.goods_name}}</p>
							<p class="goods-num">x{{cartItem.goods_number}}</p>
							<p class="goods-coach">¥{{cartItem.present_price}}</p>
						</div>
					</a>
				</div>

				<div class="cartBottom-detail inlinkFlex">
					<div class="goods-radio" @click="onGoodsRadioAll()">
						<img src="../img/icon/radio.png" v-show="!goodsRadioAll" />
						<img src="../img/icon/radio_select.png" v-show="goodsRadioAll" />
					</div>
					<div class="bottom-left">
						<p>合计: <span class="goods-coach">¥{{allCoach}}</span> </p>
					</div>
					<p class="delete" @click="onGoodsDel()">删除</p>
					<div class="subminCart" @click="onBuy()">
						购买
					</div>
				</div>
				<div class="footer inlinkFlex-around">
					<div class="footer-item">
						<a href="../index.html">
							<i class="icon footerIcon footerHomeIcon"></i>
							<p class="footer-title">首页</p>
						</a>
					</div>
					<div class="footer-item">
						<a href="categotry.html">
							<i class="icon footerIcon footerCategoryIcon"></i>
							<p class="footer-title">分类</p>
						</a>
					</div>
					<div class="footer-item active">
						<a href="cart.html">
							<i class="icon footerIcon footerCartIcon"></i>
							<p class="footer-title">购物车</p>
						</a>
					</div>
					<div class="footer-item">
						<a href="member.html">
							<i class="icon footerIcon footerMemberIcon"></i>
							<p class="footer-title">我的</p>
						</a>
					</div>
				</div>
				<!--提示成功弹窗-->
				<div class="model" v-show="tipModel">
					<div class="model-content tip-content">
						<p>{{tipText}}</p>
						<p @click="tipModel=false">确定</p>
					</div>
				</div>
			</div>
		</div>

		<script src="../js/axios.js"></script>
		<script src="../js/http.js"></script>
		<script src="../js/vue.js"></script>
		<script>
			new Vue({
				el: '#app',
				data() {
					return {
						goodsRadio: false,
						goodsRadioAll: false,
						cartList: [], //购物车列表
						allCoach: '',
						/*所以商品价格*/
						tipModel: false,
						tipText: '' /*弹窗提示文字*/
					}
				},
				mounted: function() {
					this.getCartList();
				},
				methods: {
					/*获取购物车列表*/
					getCartList() {
						const that = this;
						axios.post(path + 'cart/getCartList', {

							}).then(function(res) {
								that.cartList = res.data.data.data;
								console.log('cartListData', that.cartList);
							})
							.catch(function(error) {
								console.log(error);
							});
					},
					/*选择单个商品*/
					onGoodsRadio(item) {
						const that = this;
						if(typeof item.goodsRadio == 'undefined') {
							that.$set(item, "goodsRadio", true);
						} else {
							item.goodsRadio = !item.goodsRadio;
						}
						if(item.goodsRadio == false) {
							that.goodsRadioAll = false;
						}
						that.onCalAllCoach();
					},
					/*选择所有商品*/
					onGoodsRadioAll() {
						const that = this;
						that.goodsRadio = !that.goodsRadio;
						that.goodsRadioAll = !that.goodsRadioAll;
						if(that.goodsRadioAll == true) {
							that.cartList.forEach(function(item) {
								item.goodsRadio = true;
							})
						} else {
							that.cartList.forEach(function(item) {
								item.goodsRadio = false;
							})
						}
						that.onCalAllCoach();
					},
					/*计算价格*/
					onCalAllCoach() {
						const that = this;
						that.allCoach = 0;
						that.cartList.forEach(function(item) {
							if(item.goodsRadio) {
								that.allCoach += item.goods_number * item.present_price;

							}
						})
					},
					/*商品购买*/
					onBuy() {
						const that = this;
						goodsArr = []
						that.cartList.forEach(function(item) {
							if(item.goodsRadio == true) {
								goodsArr.push(item.id);
							}
						});
						if(goodsArr.length === 0) {
							that.tipText = '请选择要的商品'
							that.tipModel = true;							
						}else{
							location.href = "paywaitDetail.html?id=" + goodsArr + "&&pageurl=1";
						}
					},
					
					/*商品删除*/
					onGoodsDel() {
						const that = this;
						delArr = [];
						delBox = [];
						that.cartList.forEach(function(item) {
							
							if(item.goodsRadio == true) {
								delArr.push(item.id);
								delBox.push(item);
//								delBox.push(item);
							}
						});
						if(delArr.length === 0) {
							that.tipText = '请选择要删除的商品'
							that.tipModel = true;							
						}else {

//							//做比较的两个数组
							/*var array1 = that.cartList;//数组1
							var array2 = delBox;//数组2*/
//							var array1 = [{"a":1},{"b":2},{"c":3}];//数组1
//							var array2 = [{"c":3}];//数组2
//							console.log(array1,array2)
//							//临时数组存放
//							var tempArray1 = [];//临时数组1
//							var tempArray2 = [];//临时数组2
//							
//							for(var i=0;i<array2.length;i++){
//							    tempArray1[array2[i]]=true;//将数array2 中的元素值作为tempArray1 中的键，值为true；
//							}
//							
//							for(var i=0;i<array1.length;i++){
//							    if(!tempArray1[array1[i]]){
//							        tempArray2.push(array1[i]);//过滤array1 中与array2 相同的元素；
//							    }
//							}
//							console.log(tempArray2)
								
							
//							that.cartList.delete(2);
//							that.cartList.$remove(delBox);
//							console.log('delbox',delBox);
//							delArr.forEach(function(value,index){
//								that.cartList.splice(index,delArr.length);
//								console.log('delArr.length',delArr.length)
//							});
							
							axios.post(path + 'cart/delGoodsInCart/', {
									'ids': delArr.join(','),
								}).then(function(res) {
									if(res.data.errcode == 200) {
										that.getCartList();									
										that.tipText = '删除成功';
										that.tipModel = true;
									}
									console.log('goodsDel', res);
								})
								.catch(function(error) {
									console.log(error);
								});
						}

					},
				},
			})
		</script>
	</body>

</html>